<ContentDialog
    x:Class="MyShopClient.Views.Orders.CustomerSelectionDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MyShopClient.Views.Orders"
    xmlns:vm="using:MyShopClient.ViewModels"
    xmlns:helpers="using:MyShopClient.Helpers"
    Title="Select Customer"
    PrimaryButtonText="Select"
    SecondaryButtonText="Cancel"
    DefaultButton="Primary"
    Style="{StaticResource DefaultContentDialogStyle}"
    RequestedTheme="{x:Bind RequestedTheme, Mode=OneWay}">

    <ContentDialog.Resources>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <DataTemplate x:Key="CustomerItemTemplate" x:DataType="vm:CustomerViewModel">
            <Grid Padding="12" Background="{ThemeResource SystemChromeLowColor}" CornerRadius="4" Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <Ellipse Width="40" Height="40" Margin="0,0,12,0">
                    <Ellipse.Fill>
                        <ImageBrush ImageSource="{x:Bind AvatarUrl}"/>
                    </Ellipse.Fill>
                </Ellipse>
                
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold"/>
                    <TextBlock Text="{x:Bind Email}" FontSize="12" Foreground="{ThemeResource TextSecondaryBrush}"/>
                </StackPanel>
            </Grid>
        </DataTemplate>
    </ContentDialog.Resources>

    <Grid Width="500" Height="500">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search Bar -->
        <Grid Grid.Row="0" ColumnSpacing="8" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox 
                PlaceholderText="Search customer by name, email, phone..." 
                Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                KeyDown="SearchBox_KeyDown"/>
            <Button Grid.Column="1" Command="{x:Bind ViewModel.SearchCommand}">
                <FontIcon Glyph="&#xE721;"/>
            </Button>
        </Grid>

        <!-- Loading -->
        <ProgressBar 
            Grid.Row="1" 
            VerticalAlignment="Top" 
            IsIndeterminate="True" 
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>

        <!-- Customer List -->
        <ListView
            Grid.Row="1"
            ItemsSource="{x:Bind ViewModel.Customers, Mode=OneWay}"
            SelectedItem="{x:Bind ViewModel.SelectedCustomer, Mode=TwoWay}"
            SelectionMode="Single"
            ItemTemplate="{StaticResource CustomerItemTemplate}">
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>

        <!-- Create New Section -->
        <Expander Grid.Row="2" Header="Create New Customer" Margin="0,16,0,0" IsExpanded="{x:Bind ViewModel.IsCreatingNew, Mode=TwoWay}">
            <StackPanel Spacing="12" Padding="0,12,0,0">
                <TextBox Header="Name" PlaceholderText="Full Name" Text="{x:Bind ViewModel.NewCustomerName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBox Header="Email" PlaceholderText="email@example.com" Text="{x:Bind ViewModel.NewCustomerEmail, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBox Header="Phone" PlaceholderText="+1 234..." Text="{x:Bind ViewModel.NewCustomerPhone, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBox Header="Address" PlaceholderText="Full Address" Text="{x:Bind ViewModel.NewCustomerAddress, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                
                <Button Command="{x:Bind ViewModel.CreateNewCustomerCommand}" HorizontalAlignment="Right" Style="{ThemeResource AccentButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE710;" FontSize="12"/>
                        <TextBlock Text="Create &amp; Select"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Expander>
    </Grid>
</ContentDialog>
