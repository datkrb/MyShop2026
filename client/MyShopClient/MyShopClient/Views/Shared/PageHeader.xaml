<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="MyShopClient.Views.Shared.PageHeader"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Height="80" Padding="32,0" Background="{ThemeResource CardBackgroundBrush}" BorderBrush="{ThemeResource BorderBrush}" BorderThickness="0,0,0,1">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/> <!-- Hamburger (Mobile Only) -->
            <ColumnDefinition Width="*"/>    <!-- Title/Description -->
            <ColumnDefinition Width="Auto"/> <!-- Right section -->
        </Grid.ColumnDefinitions>

        <!-- Mobile Menu Button (Optional) -->
        <Button x:Name="MobileMenuButton" Visibility="Collapsed" Background="Transparent" BorderThickness="0" Margin="0,0,16,0">
            <FontIcon Glyph="&#xE700;" FontFamily="{ThemeResource SymbolThemeFontFamily}" FontSize="20" Foreground="{ThemeResource TextSecondaryBrush}"/>
        </Button>

        <!-- Title Section -->
        <StackPanel Grid.Column="1" VerticalAlignment="Center">
            <TextBlock x:Name="TitleTextBlock" Text="{x:Bind Title, Mode=OneWay}" FontWeight="Bold" FontSize="20" Foreground="{ThemeResource TextPrimaryBrush}"/>
            <TextBlock x:Name="DescriptionTextBlock" Text="{x:Bind Description, Mode=OneWay}" FontSize="12" Foreground="{ThemeResource TextSecondaryBrush}"/>
        </StackPanel>

        <!-- Right Section: User Profile -->
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center" Margin="0,0,24,0">
            
            <!-- User Button with Flyout -->
            <Button     
                x:Name="UserButton"
                Background="Transparent" 
                BorderThickness="0" 
                Padding="0"
                VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <PersonPicture Width="40" Height="40" DisplayName="{x:Bind ViewModel.UserName, Mode=OneWay}" Margin="0"/>
                    <StackPanel VerticalAlignment="Center" Visibility="Visible">
                         <TextBlock x:Name="UserNameTextBlock" Text="{x:Bind ViewModel.UserName, Mode=OneWay}" FontWeight="SemiBold" FontSize="14" Foreground="{ThemeResource TextPrimaryBrush}"/>
                         <TextBlock x:Name="UserRoleTextBlock" Text="{x:Bind ViewModel.UserRole, Mode=OneWay}" FontSize="12" Foreground="{ThemeResource TextSecondaryBrush}"/>
                    </StackPanel>
                    <FontIcon Glyph="&#xE70D;" FontFamily="{ThemeResource SymbolThemeFontFamily}" FontSize="12" Foreground="{ThemeResource TextSecondaryBrush}" Margin="0,4,0,0"/>
                </StackPanel>
                
                <Button.Flyout>
                    <Flyout x:Name="UserFlyout" Placement="BottomEdgeAlignedRight">
                        <StackPanel Spacing="16" MinWidth="200" Padding="8">
                            <!-- User Info -->
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <PersonPicture Width="48" Height="48" DisplayName="{x:Bind ViewModel.UserName, Mode=OneWay}"/>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{x:Bind ViewModel.UserName, Mode=OneWay}" FontWeight="SemiBold" FontSize="14" Foreground="{ThemeResource TextPrimaryBrush}"/>
                                    <TextBlock Text="{x:Bind ViewModel.UserRole, Mode=OneWay}" FontSize="12" Foreground="{ThemeResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Divider -->
                            <Border Height="1" Background="{ThemeResource BorderBrush}" Margin="-8,0"/>
                            
                            <!-- Logout Button -->
                            <Button 
                                x:Name="LogoutButton"
                                Command="{x:Bind ViewModel.LogoutCommand}"
                                HorizontalAlignment="Stretch" 
                                HorizontalContentAlignment="Left"
                                Background="Transparent" 
                                BorderThickness="0"
                                Padding="8">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE7E8;" FontSize="16" Foreground="{ThemeResource DangerBrush}"/>
                                    <TextBlock Text="Logout" Foreground="{ThemeResource DangerBrush}"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Flyout>
                </Button.Flyout>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>
